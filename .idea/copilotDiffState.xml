<?xml version="1.0" encoding="UTF-8"?>
<project version="4">
  <component name="CopilotDiffPersistence">
    <option name="pendingDiffs">
      <map>
        <entry key="$PROJECT_DIR$/BE/sale-tech-web/src/main/resources/insert_categories.sql">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/BE/sale-tech-web/src/main/resources/insert_categories.sql" />
              <option name="updatedContent" value="-- Insert sample categories if not exists&#10;-- Run this script if your categories table is empty&#10;&#10;-- Check if categories exist&#10;DO $$&#10;BEGIN&#10;    IF NOT EXISTS (SELECT 1 FROM categories LIMIT 1) THEN&#10;        -- Insert default categories&#10;        INSERT INTO categories (name) VALUES &#10;            ('Máy tính xách tay'),&#10;            ('Điện thoại di động'),&#10;            ('Phụ kiện'),&#10;            ('Màn hình'),&#10;            ('Bàn phím'),&#10;            ('Chuột'),&#10;            ('Tai nghe');&#10;        &#10;        RAISE NOTICE 'Categories inserted successfully';&#10;    ELSE&#10;        RAISE NOTICE 'Categories already exist';&#10;    END IF;&#10;END $$;&#10;&#10;-- Verify categories&#10;SELECT * FROM categories ORDER BY id;&#10;" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/FE/my-react-app/src/pages/homepage/Home_FINAL.js">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/FE/my-react-app/src/pages/homepage/Home_FINAL.js" />
              <option name="updatedContent" value="import React, {useEffect, useState} from 'react';&#10;import '../../App.scss';&#10;import './Home.scss';&#10;import 'react-toastify/dist/ReactToastify.css';&#10;import ProductGrid from &quot;../../components/productgrid/ProductGrid&quot;;&#10;import Nav from &quot;../../components/navigation/Nav&quot;;&#10;import Header from &quot;../../components/header/Header&quot;;&#10;import FilterSidebar from &quot;../../components/filtersidebar/FilterSidebar&quot;;&#10;import useFetchProducts, { filterProducts, searchProducts } from &quot;../../api/ProductAPI&quot;;&#10;import {getCartItems} from &quot;../../api/CartAPI&quot;;&#10;&#10;function Home() {&#10;    const {products: allProducts, loading: initialLoading, error: initialError} = useFetchProducts();&#10;    const [count, setCount] = useState(0);&#10;    const {totalQuantity} = getCartItems();&#10;&#10;    // State for filtering&#10;    const [selectedCategoryId, setSelectedCategoryId] = useState(null);&#10;    const [selectedCategoryName, setSelectedCategoryName] = useState('');&#10;    const [products, setProducts] = useState([]);&#10;    const [loading, setLoading] = useState(false);&#10;    const [error, setError] = useState(null);&#10;&#10;    useEffect(() =&gt; {&#10;        setCount(totalQuantity);&#10;    }, [totalQuantity]);&#10;&#10;    // Load all products initially&#10;    useEffect(() =&gt; {&#10;        if (!initialLoading &amp;&amp; allProducts) {&#10;            setProducts(allProducts);&#10;        }&#10;    }, [allProducts, initialLoading]);&#10;&#10;    // Handle category change&#10;    const handleCategoryChange = async (categoryId) =&gt; {&#10;        setSelectedCategoryId(categoryId);&#10;        setError(null);&#10;&#10;        if (!categoryId) {&#10;            // Show all products&#10;            setProducts(allProducts);&#10;            setSelectedCategoryName('');&#10;            return;&#10;        }&#10;&#10;        setLoading(true);&#10;        try {&#10;            const filtered = await filterProducts(categoryId, {});&#10;            setProducts(filtered);&#10;            &#10;            // Get category name from CATEGORIES&#10;            const categoryNames = {&#10;                1: 'Máy tính xách tay',&#10;                2: 'Điện thoại di động',&#10;                3: 'Phụ kiện'&#10;            };&#10;            setSelectedCategoryName(categoryNames[categoryId] || '');&#10;        } catch (err) {&#10;            setError('Không thể tải sản phẩm');&#10;            console.error(err);&#10;        } finally {&#10;            setLoading(false);&#10;        }&#10;    };&#10;&#10;    // Handle filter change from sidebar&#10;    const handleFilterChange = async (filters) =&gt; {&#10;        if (!selectedCategoryId) return;&#10;&#10;        setLoading(true);&#10;        setError(null);&#10;        try {&#10;            const filtered = await filterProducts(selectedCategoryId, filters);&#10;            setProducts(filtered);&#10;        } catch (err) {&#10;            setError('Không thể lọc sản phẩm');&#10;            console.error(err);&#10;        } finally {&#10;            setLoading(false);&#10;        }&#10;    };&#10;&#10;    // Handle search&#10;    const handleSearch = async (keyword) =&gt; {&#10;        if (!keyword || keyword.trim() === '') {&#10;            // Reset to current view&#10;            if (selectedCategoryId) {&#10;                handleCategoryChange(selectedCategoryId);&#10;            } else {&#10;                setProducts(allProducts);&#10;            }&#10;            return;&#10;        }&#10;&#10;        setLoading(true);&#10;        setError(null);&#10;        try {&#10;            const results = await searchProducts(keyword);&#10;            setProducts(results);&#10;            setSelectedCategoryId(null); // Clear category when searching&#10;        } catch (err) {&#10;            setError('Không thể tìm kiếm sản phẩm');&#10;            console.error(err);&#10;        } finally {&#10;            setLoading(false);&#10;        }&#10;    };&#10;&#10;    if (initialLoading) return &lt;div className=&quot;loading-container&quot;&gt;&lt;p&gt;Đang tải sản phẩm...&lt;/p&gt;&lt;/div&gt;;&#10;    if (initialError) return &lt;div className=&quot;error-container&quot;&gt;&lt;p&gt;{initialError}&lt;/p&gt;&lt;/div&gt;;&#10;&#10;    return (&#10;        &lt;div className={&quot;MyApp&quot;}&gt;&#10;            &lt;Nav count={count}/&gt;&#10;&#10;            &lt;Header&#10;                title=&quot;Product&quot;&#10;                onSearch={handleSearch}&#10;                selectedCategoryId={selectedCategoryId}&#10;                onCategoryChange={handleCategoryChange}&#10;                modeDisplay={&quot;product&quot;}&#10;            /&gt;&#10;&#10;            &lt;div className=&quot;home-content&quot;&gt;&#10;                {/* Sidebar Filter - Only show when category is selected */}&#10;                {selectedCategoryId &amp;&amp; (&#10;                    &lt;div className=&quot;sidebar-container&quot;&gt;&#10;                        &lt;FilterSidebar&#10;                            categoryId={selectedCategoryId}&#10;                            categoryName={selectedCategoryName}&#10;                            onFilterChange={handleFilterChange}&#10;                        /&gt;&#10;                    &lt;/div&gt;&#10;                )}&#10;&#10;                {/* Product Grid */}&#10;                &lt;div className={`products-container ${selectedCategoryId ? 'with-sidebar' : 'full-width'}`}&gt;&#10;                    {loading &amp;&amp; &lt;div className=&quot;loading-overlay&quot;&gt;Đang tải...&lt;/div&gt;}&#10;                    {error &amp;&amp; &lt;div className=&quot;error-message&quot;&gt;{error}&lt;/div&gt;}&#10;                    &lt;ProductGrid products={products} count={setCount}/&gt;&#10;                &lt;/div&gt;&#10;            &lt;/div&gt;&#10;        &lt;/div&gt;&#10;    );&#10;}&#10;&#10;export default Home&#10;" />
            </PendingDiffInfo>
          </value>
        </entry>
      </map>
    </option>
  </component>
</project>